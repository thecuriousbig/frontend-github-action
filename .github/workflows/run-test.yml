name: 'run test'

on:
  pull_request_target:
    branches:
      - main
      - dev
    types:
      - opened
      - reopened
  workflow_call:

jobs:
  remove-previous-labeled:
    runs-on: ubuntu-latest
    continue-on-error: true
    steps:
      - name: remove ready-to-test label
        uses: actions-ecosystem/action-remove-labels@v1
        with:
          labels: |
            'ready to test'
            'test success'
            'test failure'

  test:
    runs-on: ubuntu-latest
    steps:
      - name: test on circleci
        id: test-circleci
        uses: CircleCI-Public/trigger-circleci-pipeline-action@v1.0.4
        with:
          GHA_Meta: test
        env:
          CCI_TOKEN: ${{ secrets.CCI_TOKEN }}

  # test:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: checkout github
  #       uses: actions/checkout@v3
  #     - name: setup node
  #       uses: actions/setup-node@v2
  #       with:
  #         node-version: '14'
  #     - name: install dependencies
  #       run: npm install
  #     - name: run test [ci mode]
  #       id: ci-test
  #       run: npm run test
  #       env:
  #         CI: true

  # test-result:
  #   runs-on: ubuntu-latest
  #   needs: test
  #   steps:
  #     - name: add test's result label
  #       uses: actions-ecosystem/action-add-labels@v1
  #       with:
  #         labels: 'test ${{ needs.test.result }}'
